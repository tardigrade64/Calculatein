<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Scientific Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            width: 320px;
            margin: auto;
            text-align: center;
            padding: 20px;
        }
        #result {
            width: 100%;
            text-align: right;
            font-size: 24px;
            margin-bottom: 20px;
        }
        button {
            font-size: 18px;
            margin: 5px;
            padding: 10px;
            width: 70px;
        }
        .btn-toggle, .btn-graph {
            width: 150px;
        }
        canvas {
            margin-top: 20px;
            max-width: 100%;
        }
        .dark-mode {
            background-color: #2c3e50;
            color: white;
        }
        .light-mode {
            background-color: #ecf0f1;
            color: black;
        }
    </style>
</head>
<body class="light-mode">
    <div class="container">
        <input type="text" id="result" disabled>
        <br>
        <button onclick="clearScreen()">C</button>
        <button onclick="toggleNotation()">Toggle Notation</button>
        <button onclick="calculateFactorial()">n!</button>
        <button onclick="calculateGamma()">Γ(n)</button>
        <br>
        <button onclick="plotFactorial()">Plot Factorial</button>
        <button onclick="calculateBeta()">B(x, y)</button>
        <button onclick="calculateZeta()">ζ(n)</button>
        <br>
        <button class="btn-toggle" onclick="toggleMode()">Toggle Dark Mode</button>
        <canvas id="factorialChart"></canvas>
        <canvas id="gammaChart" style="display: none;"></canvas>
        <canvas id="betaChart" style="display: none;"></canvas>
    </div>

    <script>
        let useScientificNotation = true;
        let darkMode = false;

        function toggleMode() {
            darkMode = !darkMode;
            document.body.className = darkMode ? "dark-mode" : "light-mode";
        }

        function toggleNotation() {
            useScientificNotation = !useScientificNotation;
            alert("Scientific Notation: " + (useScientificNotation ? "ON" : "OFF"));
        }

        function formatNumber(num) {
            if (typeof num !== "number") return num;
            if (useScientificNotation && Math.abs(num) >= 1e15) {
                return num.toExponential(10);
            }
            return num.toFixed(20).replace(/\.?0+$/, '');
        }

        function gammaFunction(z) {
            const g = 7;
            const coefficients = [0.99999999999980993, 676.5203681218851, -1259.1392167224028,
                771.32342877765313, -176.61502916214059, 12.507343278686905,
                -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7];

            if (z < 0.5) {
                return Math.PI / (Math.sin(Math.PI * z) * gammaFunction(1 - z));
            } else {
                z -= 1;
                let x = coefficients[0];
                for (let i = 1; i < g + 2; i++) {
                    x += coefficients[i] / (z + i);
                }
                let t = z + g + 0.5;
                return Math.sqrt(2 * Math.PI) * Math.pow(t, z + 0.5) * Math.exp(-t) * x;
            }
        }

        function factorial(n) {
            if (n > 170) {
                // For n > 170, use Stirling's approximation
                return stirlingApproximation(n);
            }
            if (Number.isInteger(n)) {
                if (n < 0) return "Undefined";
                let result = BigInt(1);
                for (let i = BigInt(2); i <= BigInt(n); i++) {
                    result *= i;
                }
                return result.toString();
            } else {
                return formatNumber(gammaFunction(n + 1));
            }
        }

        // Stirling's approximation for large n!
        function stirlingApproximation(n) {
            const sqrtTwoPi = Math.sqrt(2 * Math.PI * n);
            const powerTerm = Math.pow(n / Math.E, n);
            return formatNumber(sqrtTwoPi * powerTerm);
        }

        function betaFunction(x, y) {
            return formatNumber(gammaFunction(x) * gammaFunction(y) / gammaFunction(x + y));
        }

        function zetaFunction(s, terms = 100) {
            if (s <= 1) return "Divergent";
            let sum = 0;
            for (let n = 1; n <= terms; n++) {
                sum += 1 / Math.pow(n, s);
            }
            return formatNumber(sum);
        }

        function clearScreen() {
            document.getElementById("result").value = "";
        }

        function calculateFactorial() {
            let value = parseFloat(document.getElementById("result").value);
            if (isNaN(value)) {
                document.getElementById("result").value = "Error";
                return;
            }
            document.getElementById("result").value = factorial(value);
        }

        function calculateGamma() {
            let value = parseFloat(document.getElementById("result").value);
            if (isNaN(value)) {
                document.getElementById("result").value = "Error";
                return;
            }
            document.getElementById("result").value = formatNumber(gammaFunction(value));
        }

        function calculateBeta() {
            let x = parseFloat(prompt("Enter x:"));
            let y = parseFloat(prompt("Enter y:"));
            if (isNaN(x) || isNaN(y)) {
                document.getElementById("result").value = "Error";
                return;
            }
            document.getElementById("result").value = betaFunction(x, y);
        }

        function calculateZeta() {
            let s = parseFloat(prompt("Enter s:"));
            if (isNaN(s)) {
                document.getElementById("result").value = "Error";
                return;
            }
            document.getElementById("result").value = zetaFunction(s);
        }

        function plotFactorial() {
            let ctx = document.getElementById('factorialChart').getContext('2d');
            let labels = [];
            let data = [];
            for (let i = 0; i <= 10; i++) {
                labels.push(i);
                data.push(parseFloat(factorial(i)));
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Factorial Growth',
                        data: data,
                        borderColor: 'blue',
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Add plotting functionality for Gamma and Beta
        function plotGamma() {
            let ctx = document.getElementById('gammaChart').getContext('2d');
            let labels = [];
            let data = [];
            for (let i = 0; i <= 10; i++) {
                labels.push(i);
                data.push(parseFloat(formatNumber(gammaFunction(i))));
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Gamma Function',
                        data: data,
                        borderColor: 'green',
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function plotBeta() {
            let ctx = document.getElementById('betaChart').getContext('2d');
            let labels = [];
            let data = [];
            for (let i = 1; i <= 10; i++) {
                labels.push(i);
                data.push(parseFloat(formatNumber(betaFunction(i, i+1))));
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Beta Function',
                        data: data,
                        borderColor: 'red',
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
